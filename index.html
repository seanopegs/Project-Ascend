<!DOCTYPE html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Ascend - Sebuah Kisah Teks</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div
      id="startScreen"
      class="start-screen"
      role="dialog"
      aria-modal="true"
      aria-labelledby="startScreenTitle"
      hidden
    >
      <div class="start-screen__panel">
        <h2 id="startScreenTitle" class="start-screen__title">Project Ascend</h2>
        <p class="start-screen__subtitle">
          Kelola malam menegangkan, lindungi keluarga, dan atur strategi keluar dari lilitan utang.
        </p>
        <div class="start-screen__status" id="startScreenStatus" aria-live="polite">
          Memeriksa progres tersimpanâ€¦
        </div>
        <div class="start-screen__actions">
          <button id="startNewGame" class="button accent" type="button">New Game</button>
          <button id="startContinue" class="button" type="button" disabled>Continue</button>
          <button id="startLoad" class="button secondary" type="button">Load File</button>
        </div>
        <p class="start-screen__message" id="startScreenMessage" role="status" aria-live="polite"></p>
      </div>
      <input id="startLoadInput" type="file" accept="application/json" hidden />
    </div>
    <div class="app-shell" aria-live="polite" id="appShell">
      <header class="app-header">
        <div>
          <h1>Project Ascend</h1>
          <p class="subtitle">
            Visual novel taktis tentang bertahan dari lilitan utang sambil merawat orang tua.
          </p>
        </div>
        <div class="header-meta">
          <span class="badge">Malam 1</span>
          <span class="badge accent">Taktik Bertahan</span>
          <button
            id="themeToggle"
            class="theme-toggle"
            type="button"
            aria-pressed="false"
            aria-label="Aktifkan mode terang"
          >
            <span class="theme-toggle__icon" aria-hidden="true">ðŸŒ™</span>
            <span class="theme-toggle__label">Mode Gelap</span>
          </button>
        </div>
      </header>
      <div class="app-layout">
        <main class="app-main">
          <div class="narrative-columns">
            <section id="status" class="status" aria-label="Situasi terbaru">
              <header class="section-heading">
                <h2 id="statusHeadingTitle">Kondisi Malam Ini</h2>
                <p id="statusSummary" class="status-summary"></p>
              </header>
              <div id="statusMetrics" class="status-metrics"></div>
            </section>
            <div class="story-column">
              <section id="story" class="story" tabindex="0" aria-label="Narasi"></section>
              <section
                id="feedback"
                class="feedback"
                aria-live="polite"
                aria-label="Perubahan terbaru"
              ></section>
              <section id="choices" class="choices" aria-label="Pilihan"></section>
              <button id="restart" class="restart" type="button" hidden>Mulai Lagi</button>
            </div>
          </div>
        </main>
        <aside class="app-sidebar">
          <section class="map-panel" aria-label="Denah lokasi">
            <header class="section-heading">
              <h2>Denah Rumah</h2>
              <p>Jejak ruang yang bisa kamu jelajahi malam ini.</p>
            </header>
            <div id="miniMap" class="mini-map"></div>
          </section>
          <div class="sidebar-controls" role="group" aria-label="Panel referensi cepat">
            <button
              id="toggleStats"
              class="button tertiary"
              type="button"
              aria-expanded="false"
            >
              Tampilkan Stat Karakter
            </button>
            <button id="journalButton" class="button tertiary" type="button" aria-expanded="false">
              Lihat Jurnal
            </button>
            <button id="manualSaveButton" class="button tertiary" type="button">
              Unduh Save File
            </button>
          </div>
          <p id="saveStatus" class="save-status" aria-live="polite"></p>
          <section id="stats" class="stats-panel" hidden aria-label="Stat karakter"></section>
          <section id="journalPanel" class="journal-panel" hidden></section>
        </aside>
      </div>
    </div>
    <script type="module">
      import("./scripts/main.js").catch((error) => {
        window.__JALAN_KELUAR_MODULE_ERROR__ = error;
        window.dispatchEvent(new CustomEvent("jalanKeluar:module-error", { detail: error }));
      });
    </script>
    <script>
      (function () {
        function startFallback() {
          const script = document.createElement("script");
          script.src = "./scripts/bundle.js";
          script.async = false;
          script.onload = () => {
            const game = window.GameApp || window;
            const initializer = game && typeof game.initializeGame === "function" ? game.initializeGame : null;
            if (!initializer) {
              console.error("Fallback skrip termuat, tetapi inisialisasi game tidak ditemukan.");
              return;
            }
            if (document.readyState === "loading") {
              document.addEventListener("DOMContentLoaded", initializer, { once: true });
            } else {
              initializer();
            }
          };
          script.onerror = () => {
            console.error("Gagal memuat skrip fallback untuk game.");
          };
          document.head.appendChild(script);
        }

        if (window.__JALAN_KELUAR_MODULE_ERROR__) {
          startFallback();
          return;
        }

        window.addEventListener("jalanKeluar:module-error", startFallback, { once: true });
      })();
    </script>
  </body>
</html>
