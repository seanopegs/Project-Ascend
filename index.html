<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jalan Keluar - Sebuah Kisah Teks</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell" aria-live="polite">
      <header class="app-header">
        <div>
          <h1>Jalan Keluar</h1>
          <p class="subtitle">
            Visual novel taktis tentang bertahan dari lilitan utang sambil merawat orang tua.
          </p>
        </div>
        <div class="header-meta">
          <span class="badge">Malam 1</span>
          <span class="badge accent">Taktik Bertahan</span>
        </div>
      </header>
      <div class="app-layout">
        <aside class="app-sidebar">
          <section id="status" class="status" aria-label="Situasi terbaru">
            <header class="section-heading">
              <h2>Kondisi Malam Ini</h2>
              <p id="statusSummary" class="status-summary"></p>
            </header>
            <div id="statusMetrics" class="status-metrics"></div>
          </section>
          <section class="map-panel" aria-label="Denah lokasi">
            <header class="section-heading">
              <h2>Denah Rumah</h2>
              <p>Jejak ruang yang bisa kamu jelajahi malam ini.</p>
            </header>
            <div id="miniMap" class="mini-map"></div>
          </section>
          <div class="sidebar-controls">
            <button
              id="toggleStats"
              class="button tertiary"
              type="button"
              aria-expanded="false"
            >
              Tampilkan Stat Karakter
            </button>
            <button id="journalButton" class="button tertiary" type="button" aria-expanded="false">
              Lihat Jurnal
            </button>
          </div>
          <section id="stats" class="stats-panel" hidden aria-label="Stat karakter"></section>
          <section id="journalPanel" class="journal-panel" hidden aria-label="Jurnal masa depan"></section>
        </aside>
        <main class="app-main">
          <section id="story" class="story" tabindex="0" aria-label="Narasi"></section>
          <section
            id="feedback"
            class="feedback"
            aria-live="polite"
            aria-label="Perubahan terbaru"
          ></section>
          <section id="choices" class="choices" aria-label="Pilihan"></section>
          <button id="restart" class="restart" type="button" hidden>Mulai Lagi</button>
        </main>
      </div>
    </div>
    <script type="module">
      import("./scripts/main.js").catch((error) => {
        window.__JALAN_KELUAR_MODULE_ERROR__ = error;
        window.dispatchEvent(new CustomEvent("jalanKeluar:module-error", { detail: error }));
      });
    </script>
    <script>
      (function () {
        function startFallback() {
          const script = document.createElement("script");
          script.src = "./scripts/bundle.js";
          script.async = false;
          script.onload = () => {
            const game = window.GameApp || window;
            const initializer = game && typeof game.initializeGame === "function" ? game.initializeGame : null;
            if (!initializer) {
              console.error("Fallback skrip termuat, tetapi inisialisasi game tidak ditemukan.");
              return;
            }
            if (document.readyState === "loading") {
              document.addEventListener("DOMContentLoaded", initializer, { once: true });
            } else {
              initializer();
            }
          };
          script.onerror = () => {
            console.error("Gagal memuat skrip fallback untuk game.");
          };
          document.head.appendChild(script);
        }

        if (window.__JALAN_KELUAR_MODULE_ERROR__) {
          startFallback();
          return;
        }

        window.addEventListener("jalanKeluar:module-error", startFallback, { once: true });
      })();
    </script>
  </body>
</html>
